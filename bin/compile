#!/usr/bin/env bash

# Ensure wildcards in globs match dotfiles too.
shopt -s dotglob

indent() {
    sed -u 's/^/      /'
}

BUILD_DIR="$1"
CACHE_DIR="$2"
ENV_DIR="$3"

if [ ! -f "${ENV_DIR}/APP_BASE" ]; then
    echo "APP_BASE was not set. Aborting"
    exit 1
fi
APP_BASE="$(cat "${ENV_DIR}/APP_BASE")"
BUILD_DIR="$BUILD_DIR/$APP_BASE"

cp "$APP_DIR/requirements.txt" "$BUILD_DIR/requirements.txt" || true 
cp "$APP_DIR/package.json" "$BUILD_DIR/package.json" || true 
cp "$APP_DIR/package-lock.json" "$BUILD_DIR/package-lock.json" || true 
cp "$APP_DIR/yarn.lock" "$BUILD_DIR/yarn.lock" || true 
cp "$APP_DIR/Gemfile" "$BUILD_DIR/Gemfile" || true 
cp "$APP_DIR/Gemfile.lock" "$BUILD_DIR/Gemfile.lock" || true 
cp "$APP_DIR/app.json" "$BUILD_DIR/app.json" || true 
cp "$APP_DIR/Procfile" "$BUILD_DIR/Procfile" || true 
cp "$APP_DIR/Procfile.heroku" "$BUILD_DIR/Procfile" || true 

